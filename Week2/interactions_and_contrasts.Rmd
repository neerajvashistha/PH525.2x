


<!DOCTYPE html>
<html lang="en" class="">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    
    
    <title>labs/interactions_and_contrasts.Rmd at master · genomicsclass/labs</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-144.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144.png">
    <meta property="fb:app_id" content="1401488693436528">

      <meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="genomicsclass/labs" name="twitter:title" /><meta content="labs - Scripts for HarvardX courses: PH525x" name="twitter:description" /><meta content="https://avatars0.githubusercontent.com/u/6855004?v=3&amp;s=400" name="twitter:image:src" />
      <meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="https://avatars0.githubusercontent.com/u/6855004?v=3&amp;s=400" property="og:image" /><meta content="genomicsclass/labs" property="og:title" /><meta content="https://github.com/genomicsclass/labs" property="og:url" /><meta content="labs - Scripts for HarvardX courses: PH525x" property="og:description" />
      <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">
    <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">
    <link rel="assets" href="https://assets-cdn.github.com/">
    <link rel="web-socket" href="wss://live.github.com/_sockets/MTAxNjUxNDc6ZWQ4NmY0ZDkzNjFhNzU2MGZiZmM2MDc2ODRiYjU1MTc6ODlhN2VkOGEzZWJlNDc1OTc0NGEzMTY1OGU1MmM2N2E0MzM1MzJiMDdlYjY4MTMxNDBlNDY5MTMwYjUxMzYyNg==--3018ce753fbc82badbea074cd55494291fc12f15">
    <meta name="pjax-timeout" content="1000">
    <link rel="sudo-modal" href="/sessions/sudo_modal">

    <meta name="msapplication-TileImage" content="/windows-tile.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="selected-link" value="repo_source" data-pjax-transient>
      <meta name="google-analytics" content="UA-3769691-2">

    <meta content="collector.githubapp.com" name="octolytics-host" /><meta content="collector-cdn.github.com" name="octolytics-script-host" /><meta content="github" name="octolytics-app-id" /><meta content="6AC997F7:73E8:2C80DD3:554279DC" name="octolytics-dimension-request_id" /><meta content="10165147" name="octolytics-actor-id" /><meta content="neerajvashistha" name="octolytics-actor-login" /><meta content="1949533d062daec495d4d09ffbd6d75faec0ae68340734d5c987dd222dad492b" name="octolytics-actor-hash" />
    
    <meta content="Rails, view, blob#show" name="analytics-event" />
    <meta class="js-ga-set" name="dimension1" content="Logged In">
    <meta class="js-ga-set" name="dimension2" content="Header v3">
    <meta name="is-dotcom" content="true">
    <meta name="hostname" content="github.com">
    <meta name="user-login" content="neerajvashistha">

    
    <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">


    <meta content="authenticity_token" name="csrf-param" />
<meta content="XIx6Is04pZ2KazNYXUeCEpMsuJaXtppSlKTippxRFT+CHRSJiDiGYQ6ga7+52NPUuOM7nGVhlCqZucx+Zb0eVQ==" name="csrf-token" />

    <link href="https://assets-cdn.github.com/assets/github-ff75c30c273e51c1619d1b3793a77a80d4864486a0df51e5cc837cb07b64dd6c.css" media="all" rel="stylesheet" />
    <link href="https://assets-cdn.github.com/assets/github2-c824dcc050792a9b99cecf90812f90fa3f7f68c11e586f619219ab4f083b37ca.css" media="all" rel="stylesheet" />
    
    


    <meta http-equiv="x-pjax-version" content="8148c1f174051df6e3d065cfd70f528f">

      
  <meta name="description" content="labs - Scripts for HarvardX courses: PH525x">
  <meta name="go-import" content="github.com/genomicsclass/labs git https://github.com/genomicsclass/labs.git">

  <meta content="6855004" name="octolytics-dimension-user_id" /><meta content="genomicsclass" name="octolytics-dimension-user_login" /><meta content="15142234" name="octolytics-dimension-repository_id" /><meta content="genomicsclass/labs" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="15142234" name="octolytics-dimension-repository_network_root_id" /><meta content="genomicsclass/labs" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/genomicsclass/labs/commits/master.atom" rel="alternate" title="Recent Commits to labs:master" type="application/atom+xml">

  </head>


  <body class="logged_in  env-production windows vis-public page-blob">
    <a href="#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
    <div class="wrapper">
      
      
      


        <div class="header header-logged-in true" role="banner">
  <div class="container clearfix">

    <a class="header-logo-invertocat" href="https://github.com/" data-hotkey="g d" aria-label="Homepage" data-ga-click="Header, go to dashboard, icon:logo">
  <span class="mega-octicon octicon-mark-github"></span>
</a>


      <div class="site-search repo-scope js-site-search" role="search">
          <form accept-charset="UTF-8" action="/genomicsclass/labs/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/genomicsclass/labs/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
  <input type="text"
    class="js-site-search-field is-clearable"
    data-hotkey="s"
    name="q"
    placeholder="Search"
    data-global-scope-placeholder="Search GitHub"
    data-repo-scope-placeholder="Search"
    tabindex="1"
    autocapitalize="off">
  <div class="scope-badge">This repository</div>
</form>
      </div>

      <ul class="header-nav left" role="navigation">
          <li class="header-nav-item explore">
            <a class="header-nav-link" href="/explore" data-ga-click="Header, go to explore, text:explore">Explore</a>
          </li>
            <li class="header-nav-item">
              <a class="header-nav-link" href="https://gist.github.com" data-ga-click="Header, go to gist, text:gist">Gist</a>
            </li>
            <li class="header-nav-item">
              <a class="header-nav-link" href="/blog" data-ga-click="Header, go to blog, text:blog">Blog</a>
            </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://help.github.com" data-ga-click="Header, go to help, text:help">Help</a>
          </li>
      </ul>

      
<ul class="header-nav user-nav right" id="user-links">
  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link name" href="/neerajvashistha" data-ga-click="Header, go to profile, text:username">
      <img alt="@neerajvashistha" class="avatar" data-user="10165147" height="20" src="https://avatars0.githubusercontent.com/u/10165147?v=3&amp;s=40" width="20" />
      <span class="css-truncate">
        <span class="css-truncate-target">neerajvashistha</span>
      </span>
    </a>
  </li>

  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link js-menu-target tooltipped tooltipped-s" href="/new" aria-label="Create new..." data-ga-click="Header, create new, icon:add">
      <span class="octicon octicon-plus"></span>
      <span class="dropdown-caret"></span>
    </a>

    <div class="dropdown-menu-content js-menu-content">
      <ul class="dropdown-menu">
        
<li>
  <a href="/new" data-ga-click="Header, create new repository, icon:repo"><span class="octicon octicon-repo"></span> New repository</a>
</li>
<li>
  <a href="/organizations/new" data-ga-click="Header, create new organization, icon:organization"><span class="octicon octicon-organization"></span> New organization</a>
</li>


  <li class="dropdown-divider"></li>
  <li class="dropdown-header">
    <span title="genomicsclass/labs">This repository</span>
  </li>
    <li>
      <a href="/genomicsclass/labs/issues/new" data-ga-click="Header, create new issue, icon:issue"><span class="octicon octicon-issue-opened"></span> New issue</a>
    </li>

      </ul>
    </div>
  </li>

  <li class="header-nav-item">
      <span 
        data-channel="notification-changed:neerajvashistha"
        data-url="/notifications/header">
      <a href="/notifications" aria-label="You have no unread notifications" class="header-nav-link notification-indicator tooltipped tooltipped-s" data-ga-click="Header, go to notifications, icon:read" data-hotkey="g n">
          <span class="mail-status all-read"></span>
          <span class="octicon octicon-inbox"></span>
</a>  </span>

  </li>

  <li class="header-nav-item">
    <a class="header-nav-link tooltipped tooltipped-s" href="/settings/profile" id="account_settings" aria-label="Settings" data-ga-click="Header, go to settings, icon:settings">
      <span class="octicon octicon-gear"></span>
    </a>
  </li>

  <li class="header-nav-item">
    <form accept-charset="UTF-8" action="/logout" class="logout-form" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="mO5p3iaZ9dYa4HabMTwTOM+O91hZZALNufXuO9ds3EgdRd3fNlxxWa2awae0rVFmseWPWSD4I+evJbWWKSwVZA==" /></div>
      <button class="header-nav-link sign-out-button tooltipped tooltipped-s" aria-label="Sign out" data-ga-click="Header, sign out, icon:logout">
        <span class="octicon octicon-sign-out"></span>
      </button>
</form>  </li>

</ul>



    
  </div>
</div>

        

        


      <div id="start-of-content" class="accessibility-aid"></div>
          <div class="site" itemscope itemtype="http://schema.org/WebPage">
    <div id="js-flash-container">
      
    </div>
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        
<ul class="pagehead-actions">

  <li>
      <form accept-charset="UTF-8" action="/notifications/subscribe" class="js-social-container" data-autosubmit="true" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="6SDtUbsa7VjZ9LrODJTyZPW+Cjr3ycVw+aOd4W4fPvAs/pmPI6yhYPaavIk+UZtPOupTnK0uxSUF9r8pqLOscg==" /></div>    <input id="repository_id" name="repository_id" type="hidden" value="15142234" />

      <div class="select-menu js-menu-container js-select-menu">
        <a href="/genomicsclass/labs/subscription"
          class="btn btn-sm btn-with-count select-menu-button js-menu-target" role="button" tabindex="0" aria-haspopup="true"
          data-ga-click="Repository, click Watch settings, action:blob#show">
          <span class="js-select-button">
            <span class="octicon octicon-eye"></span>
            Watch
          </span>
        </a>
        <a class="social-count js-social-count" href="/genomicsclass/labs/watchers">
          153
        </a>

        <div class="select-menu-modal-holder">
          <div class="select-menu-modal subscription-menu-modal js-menu-content" aria-hidden="true">
            <div class="select-menu-header">
              <span class="select-menu-title">Notifications</span>
              <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
            </div>

            <div class="select-menu-list js-navigation-container" role="menu">

              <div class="select-menu-item js-navigation-item selected" role="menuitem" tabindex="0">
                <span class="select-menu-item-icon octicon octicon-check"></span>
                <div class="select-menu-item-text">
                  <input checked="checked" id="do_included" name="do" type="radio" value="included" />
                  <span class="select-menu-item-heading">Not watching</span>
                  <span class="description">Be notified when participating or @mentioned.</span>
                  <span class="js-select-button-text hidden-select-button-text">
                    <span class="octicon octicon-eye"></span>
                    Watch
                  </span>
                </div>
              </div>

              <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
                <span class="select-menu-item-icon octicon octicon octicon-check"></span>
                <div class="select-menu-item-text">
                  <input id="do_subscribed" name="do" type="radio" value="subscribed" />
                  <span class="select-menu-item-heading">Watching</span>
                  <span class="description">Be notified of all conversations.</span>
                  <span class="js-select-button-text hidden-select-button-text">
                    <span class="octicon octicon-eye"></span>
                    Unwatch
                  </span>
                </div>
              </div>

              <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
                <span class="select-menu-item-icon octicon octicon-check"></span>
                <div class="select-menu-item-text">
                  <input id="do_ignore" name="do" type="radio" value="ignore" />
                  <span class="select-menu-item-heading">Ignoring</span>
                  <span class="description">Never be notified.</span>
                  <span class="js-select-button-text hidden-select-button-text">
                    <span class="octicon octicon-mute"></span>
                    Stop ignoring
                  </span>
                </div>
              </div>

            </div>

          </div>
        </div>
      </div>
</form>
  </li>

  <li>
    
  <div class="js-toggler-container js-social-container starring-container on">

    <form accept-charset="UTF-8" action="/genomicsclass/labs/unstar" class="js-toggler-form starred js-unstar-button" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="qqQ1BIGGuiqWE6OpCHorFlEleP+fV7K505mFz3FjDeduqq5Qg5aQoiUPYEaKE0BF+U7A73Z/PAmOK5Uu+RB+Pg==" /></div>
      <button
        class="btn btn-sm btn-with-count js-toggler-target"
        aria-label="Unstar this repository" title="Unstar genomicsclass/labs"
        data-ga-click="Repository, click unstar button, action:blob#show; text:Unstar">
        <span class="octicon octicon-star"></span>
        Unstar
      </button>
        <a class="social-count js-social-count" href="/genomicsclass/labs/stargazers">
          271
        </a>
</form>
    <form accept-charset="UTF-8" action="/genomicsclass/labs/star" class="js-toggler-form unstarred js-star-button" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="FpAWjaKyF08msxlspW0sQvh+uksaQkRc3VHNSZz+6aBT3Y5J+1JMQjjyWb5neFcISB284MuNoLEo3BWfnsa8eA==" /></div>
      <button
        class="btn btn-sm btn-with-count js-toggler-target"
        aria-label="Star this repository" title="Star genomicsclass/labs"
        data-ga-click="Repository, click star button, action:blob#show; text:Star">
        <span class="octicon octicon-star"></span>
        Star
      </button>
        <a class="social-count js-social-count" href="/genomicsclass/labs/stargazers">
          271
        </a>
</form>  </div>

  </li>

        <li>
          <form accept-charset="UTF-8" action="/genomicsclass/labs/fork" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="l0rHZXxaKKyPlJuoY7g1Ul14vExGoYMxE6OSv2AXDIkAQuhedNqeoNDZm8uMUYaDuWuJE+JRt3AGhPxDh/0IWw==" /></div>
            <button
                type="submit"
                class="btn btn-sm btn-with-count"
                data-ga-click="Repository, show fork modal, action:blob#show; text:Fork"
                title="Fork your own copy of genomicsclass/labs to your account"
                aria-label="Fork your own copy of genomicsclass/labs to your account">
              <span class="octicon octicon-repo-forked"></span>
              Fork
            </button>
            <a href="/genomicsclass/labs/network" class="social-count">630</a>
</form>        </li>

</ul>

        <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="mega-octicon octicon-repo"></span>
          <span class="author"><a href="/genomicsclass" class="url fn" itemprop="url" rel="author"><span itemprop="title">genomicsclass</span></a></span><!--
       --><span class="path-divider">/</span><!--
       --><strong><a href="/genomicsclass/labs" class="js-current-repository" data-pjax="#js-repo-pjax-container">labs</a></strong>

          <span class="page-context-loader">
            <img alt="" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      <div class="repository-with-sidebar repo-container new-discussion-timeline  ">
        <div class="repository-sidebar clearfix">
            
<nav class="sunken-menu repo-nav js-repo-nav js-sidenav-container-pjax js-octicon-loaders"
     role="navigation"
     data-pjax="#js-repo-pjax-container"
     data-issue-count-url="/genomicsclass/labs/issues/counts">
  <ul class="sunken-menu-group">
    <li class="tooltipped tooltipped-w" aria-label="Code">
      <a href="/genomicsclass/labs" aria-label="Code" class="selected js-selected-navigation-item sunken-menu-item" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /genomicsclass/labs">
        <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>

      <li class="tooltipped tooltipped-w" aria-label="Issues">
        <a href="/genomicsclass/labs/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /genomicsclass/labs/issues">
          <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
          <span class="js-issue-replace-counter"></span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>      </li>

    <li class="tooltipped tooltipped-w" aria-label="Pull requests">
      <a href="/genomicsclass/labs/pulls" aria-label="Pull requests" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g p" data-selected-links="repo_pulls /genomicsclass/labs/pulls">
          <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull requests</span>
          <span class="js-pull-replace-counter"></span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>

      <li class="tooltipped tooltipped-w" aria-label="Wiki">
        <a href="/genomicsclass/labs/wiki" aria-label="Wiki" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g w" data-selected-links="repo_wiki /genomicsclass/labs/wiki">
          <span class="octicon octicon-book"></span> <span class="full-word">Wiki</span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>      </li>
  </ul>
  <div class="sunken-menu-separator"></div>
  <ul class="sunken-menu-group">

    <li class="tooltipped tooltipped-w" aria-label="Pulse">
      <a href="/genomicsclass/labs/pulse" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-selected-links="pulse /genomicsclass/labs/pulse">
        <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>

    <li class="tooltipped tooltipped-w" aria-label="Graphs">
      <a href="/genomicsclass/labs/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-selected-links="repo_graphs repo_contributors /genomicsclass/labs/graphs">
        <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>
  </ul>


</nav>

              <div class="only-with-full-nav">
                  
<div class="clone-url open"
  data-protocol-type="http"
  data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><span class="text-emphasized">HTTPS</span> clone URL</h3>
  <div class="input-group js-zeroclipboard-container">
    <input type="text" class="input-mini input-monospace js-url-field js-zeroclipboard-target"
           value="https://github.com/genomicsclass/labs.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url "
  data-protocol-type="ssh"
  data-url="/users/set_protocol?protocol_selector=ssh&amp;protocol_type=clone">
  <h3><span class="text-emphasized">SSH</span> clone URL</h3>
  <div class="input-group js-zeroclipboard-container">
    <input type="text" class="input-mini input-monospace js-url-field js-zeroclipboard-target"
           value="git@github.com:genomicsclass/labs.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url "
  data-protocol-type="subversion"
  data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><span class="text-emphasized">Subversion</span> checkout URL</h3>
  <div class="input-group js-zeroclipboard-container">
    <input type="text" class="input-mini input-monospace js-url-field js-zeroclipboard-target"
           value="https://github.com/genomicsclass/labs" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>



<p class="clone-options">You can clone with
  <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a>, <a href="#" class="js-clone-selector" data-protocol="ssh">SSH</a>, or <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <a href="https://help.github.com/articles/which-remote-url-should-i-use" class="help tooltipped tooltipped-n" aria-label="Get help on which URL is right for you.">
    <span class="octicon octicon-question"></span>
  </a>
</p>


  <a href="https://windows.github.com" class="btn btn-sm sidebar-button" title="Save genomicsclass/labs to your computer and use it in GitHub Desktop." aria-label="Save genomicsclass/labs to your computer and use it in GitHub Desktop.">
    <span class="octicon octicon-device-desktop"></span>
    Clone in Desktop
  </a>


                <a href="/genomicsclass/labs/archive/master.zip"
                   class="btn btn-sm sidebar-button"
                   aria-label="Download the contents of genomicsclass/labs as a zip file"
                   title="Download the contents of genomicsclass/labs as a zip file"
                   rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
              </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container>
          

<a href="/genomicsclass/labs/blob/591e3f0b3a22f5176066af9431d809de1a4281ec/course2/interactions_and_contrasts.Rmd" class="hidden js-permalink-shortcut" data-hotkey="y">Permalink</a>

<!-- blob contrib key: blob_contributors:v21:fbc1eb1e13d5ac06840fc7b48f2f4f99 -->

<div class="file-navigation js-zeroclipboard-container">
  
<div class="select-menu js-menu-container js-select-menu left">
  <span class="btn btn-sm select-menu-button js-menu-target css-truncate" data-hotkey="w"
    data-master-branch="master"
    data-ref="master"
    title="master"
    role="button" aria-label="Switch branches or tags" tabindex="0" aria-haspopup="true">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button css-truncate-target">master</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax aria-hidden="true">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
      </div>

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" data-filter-placeholder="Filter branches/tags" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" data-filter-placeholder="Find a tag…" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open selected"
               href="/genomicsclass/labs/blob/master/course2/interactions_and_contrasts.Rmd"
               data-name="master"
               data-skip-pjax="true"
               rel="nofollow">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <span class="select-menu-item-text css-truncate-target" title="master">
                master
              </span>
            </a>
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div>

    </div>
  </div>
</div>

  <div class="btn-group right">
    <a href="/genomicsclass/labs/find/master"
          class="js-show-file-finder btn btn-sm empty-icon tooltipped tooltipped-s"
          data-pjax
          data-hotkey="t"
          aria-label="Quickly jump between files">
      <span class="octicon octicon-list-unordered"></span>
    </a>
    <button aria-label="Copy file path to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
  </div>

  <div class="breadcrumb js-zeroclipboard-target">
    <span class='repo-root js-repo-root'><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/genomicsclass/labs" class="" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">labs</span></a></span></span><span class="separator">/</span><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/genomicsclass/labs/tree/master/course2" class="" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">course2</span></a></span><span class="separator">/</span><strong class="final-path">interactions_and_contrasts.Rmd</strong>
  </div>
</div>


  <div class="commit file-history-tease">
    <div class="file-history-tease-header">
        <img alt="@mikelove" class="avatar" data-user="69203" height="24" src="https://avatars2.githubusercontent.com/u/69203?v=3&amp;s=48" width="24" />
        <span class="author"><a href="/mikelove" rel="contributor">mikelove</a></span>
        <time datetime="2015-03-06T16:10:39Z" is="relative-time">Mar 6, 2015</time>
        <div class="commit-title">
            <a href="/genomicsclass/labs/commit/5a9dfd691773a3f5dd7b1824d980812999199e73" class="message" data-pjax="true" title="adding note about weighting">adding note about weighting</a>
        </div>
    </div>

    <div class="participation">
      <p class="quickstat">
        <a href="#blob_contributors_box" rel="facebox">
          <strong>1</strong>
           contributor
        </a>
      </p>
      
    </div>
    <div id="blob_contributors_box" style="display:none">
      <h2 class="facebox-header">Users who have contributed to this file</h2>
      <ul class="facebox-user-list">
          <li class="facebox-user-list-item">
            <img alt="@mikelove" data-user="69203" height="24" src="https://avatars2.githubusercontent.com/u/69203?v=3&amp;s=48" width="24" />
            <a href="/mikelove">mikelove</a>
          </li>
      </ul>
    </div>
  </div>

<div class="file">
  <div class="file-header">
    <div class="file-actions">

      <div class="btn-group">
        <a href="/genomicsclass/labs/raw/master/course2/interactions_and_contrasts.Rmd" class="btn btn-sm " id="raw-url">Raw</a>
          <a href="/genomicsclass/labs/blame/master/course2/interactions_and_contrasts.Rmd" class="btn btn-sm js-update-url-with-hash">Blame</a>
        <a href="/genomicsclass/labs/commits/master/course2/interactions_and_contrasts.Rmd" class="btn btn-sm " rel="nofollow">History</a>
      </div>

        <a class="octicon-btn tooltipped tooltipped-nw"
           href="https://windows.github.com"
           aria-label="Open this file in GitHub for Windows">
            <span class="octicon octicon-device-desktop"></span>
        </a>

            <form accept-charset="UTF-8" action="/genomicsclass/labs/edit/master/course2/interactions_and_contrasts.Rmd" class="inline-form" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="AmjAq4TQWXkDFWqVTVLy5AWFmsRFHP5ahfqe0WjQ2bI36hgft65GCUKTKD4ASo8HY4Kg0owtEDtPGlfwMQSbTw==" /></div>
              <button class="octicon-btn tooltipped tooltipped-n" type="submit" aria-label="Fork this project and edit the file" data-hotkey="e" data-disable-with>
                <span class="octicon octicon-pencil"></span>
              </button>
</form>
          <form accept-charset="UTF-8" action="/genomicsclass/labs/delete/master/course2/interactions_and_contrasts.Rmd" class="inline-form" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="Y30F5yoU0Mmn9zFS0X8W/RxpmjDJSswucZNnAq4nQsJw+/q87oLadKGZnYPS1PvAv+lsfANlGX73ZgqP8V8fkA==" /></div>
            <button class="octicon-btn octicon-btn-danger tooltipped tooltipped-n" type="submit" aria-label="Fork this project and delete this file" data-disable-with>
              <span class="octicon octicon-trashcan"></span>
            </button>
</form>    </div>

    <div class="file-info">
        449 lines (324 sloc)
        <span class="file-info-divider"></span>
      25.267 kb
    </div>
  </div>
    <div id="readme" class="blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="mainContentOfPage"><table data-table-type="yaml-metadata">
  <thead>
  <tr>
  <th>title</th>

  <th>layout</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>Interactions and contrasts</div></td>

  <td><div>page</div></td>
  </tr>
  </tbody>
</table><div class="highlight highlight-r"><pre>library(<span class="pl-smi">knitr</span>)
<span class="pl-smi">opts_chunk</span><span class="pl-k">$</span>set(<span class="pl-v">fig.path</span><span class="pl-k">=</span>paste0(<span class="pl-s"><span class="pl-pds">"</span>figure/<span class="pl-pds">"</span></span>, sub(<span class="pl-s"><span class="pl-pds">"</span>(.*).Rmd<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\\</span>1<span class="pl-pds">"</span></span>,basename(<span class="pl-e">knitr</span><span class="pl-k">:::</span><span class="pl-smi">knit_concord</span><span class="pl-k">$</span>get(<span class="pl-s"><span class="pl-pds">'</span>infile<span class="pl-pds">'</span></span>))), <span class="pl-s"><span class="pl-pds">"</span>-<span class="pl-pds">"</span></span>))</pre></div>

<p>For learning about linear models, we will be using a datasest which compares the different frictional coefficients on the different legs on a spider, and whether more friction comes from a pushing or pulling motion of the leg. The original paper from which the data was provided is:</p>

<p>Jonas O. Wolff  &amp; Stanislav N. Gorb, <a href="http://dx.doi.org/10.1038/srep01101">Radial arrangement of Janus-like setae permits friction control in spiders</a>, Scientific Reports, 22 January 2013.</p>

<p>The abstract of the paper says, </p>

<blockquote>
<p>The hunting spider Cupiennius salei (Arachnida, Ctenidae) possesses hairy attachment pads (claw tufts) at its distal legs, consisting of directional branched setae... Friction of claw tufts on smooth glass was measured to reveal the functional effect of seta arrangement within the pad.</p>
</blockquote>

<p>Figure 1 includes some pretty cool electron microscope images of the tufts. We are intereseted in the comparisons in Figure 4, where the pulling and pushing motions are compared for different leg pairs (for an example of pushing and pulling see the top of Figure 3). We can recreate Figure 4 of the paper, by loading the data and calling boxplot():</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">url</span> <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>https://raw.githubusercontent.com/genomicsclass/dagdata/master/inst/extdata/spider_wolff_gorb_2013.csv<span class="pl-pds">"</span></span>
<span class="pl-smi">filename</span> <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>spider_wolff_gorb_2013.csv<span class="pl-pds">"</span></span>
library(<span class="pl-smi">downloader</span>)
<span class="pl-k">if</span> (<span class="pl-k">!</span>file.exists(<span class="pl-smi">filename</span>)) download(<span class="pl-smi">url</span>, <span class="pl-smi">filename</span>)
<span class="pl-smi">spider</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-smi">filename</span>, <span class="pl-v">skip</span><span class="pl-k">=</span><span class="pl-c1">1</span>)
boxplot(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span> <span class="pl-k">~</span> <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">type</span> <span class="pl-k">*</span> <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">leg</span>, 
        <span class="pl-v">col</span><span class="pl-k">=</span>c(<span class="pl-s"><span class="pl-pds">"</span>grey90<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>grey40<span class="pl-pds">"</span></span>), <span class="pl-v">las</span><span class="pl-k">=</span><span class="pl-c1">2</span>, 
        <span class="pl-v">main</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Comparison of friction coefficients of different leg pairs <span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="user-content-initial-visual-inspection-of-the-data" class="anchor" href="#initial-visual-inspection-of-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Initial visual inspection of the data</h2>

<p>What we can see immediately, are two trends: </p>

<ul>
<li>pulling motion has a higher frictional coefficient than pushing motion</li>
<li>the leg pairs to the back of the spider (L4 being the last) generally have higher pulling frictional coefficients.</li>
</ul>

<p>Another thing to notice is that the groups have different spread, what we call <em>within-group variance</em>. This is somewhat of a problem for the kinds of linear models we will explore below, because we will assume that around the fitted values $\hat{Y}_i$, the errors $\varepsilon_i$ are distributed identically, meaning the same variance within each group. The consequence of ignoring the different variance is that comparisons between the groups with small variances will be overly "conservative" (because the overall estimate of variance is larger than these groups), and comparisons between the groups with large variances will be overly confident.</p>

<p>If the spread is related to the location, such that groups with large values also have larger spread, a possibility is to transform the data with a function such as the <code>log</code> or <code>sqrt</code>. This looks like it could be useful here, as three of the four push groups (L1, L2, L3) have the smallest values and also the smallest spread.</p>

<p>Alternative tests for comparing groups without transforming the values first are: t-tests without the equal variance assumption, using a "Welch" or "Satterthwaite approximation", or a test of a shift in distribution, such as the Mann-Whitney-Wilcoxon test.</p>

<p>However, we will continue, and show the different kinds of linear models using this dataset, setting aside the issue of different within-group variances.</p>

<h2>
<a id="user-content-a-linear-model-with-one-variable" class="anchor" href="#a-linear-model-with-one-variable" aria-hidden="true"><span class="octicon octicon-link"></span></a>A linear model with one variable</h2>

<p>Just to remind ourselves about the simple two-group linear model, let's subset to the L1 leg pair, and run <code>lm</code>:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">spider.sub</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">spider</span>[<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">leg</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>L1<span class="pl-pds">"</span></span>,]
<span class="pl-smi">fit</span> <span class="pl-k">&lt;-</span> lm(<span class="pl-smi">friction</span> <span class="pl-k">~</span> <span class="pl-smi">type</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider.sub</span>)
summary(<span class="pl-smi">fit</span>)
(<span class="pl-smi">coefs</span> <span class="pl-k">&lt;-</span> coef(<span class="pl-smi">fit</span>))</pre></div>

<p>We remember that the coefficients are just the mean of the pull observations, and the difference between the means of the two groups:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">s</span> <span class="pl-k">&lt;-</span> split(<span class="pl-smi">spider.sub</span><span class="pl-k">$</span><span class="pl-smi">friction</span>, <span class="pl-smi">spider.sub</span><span class="pl-k">$</span><span class="pl-smi">type</span>)
mean(<span class="pl-smi">s</span>[[<span class="pl-s"><span class="pl-pds">"</span>pull<span class="pl-pds">"</span></span>]])
mean(<span class="pl-smi">s</span>[[<span class="pl-s"><span class="pl-pds">"</span>push<span class="pl-pds">"</span></span>]]) <span class="pl-k">-</span> mean(<span class="pl-smi">s</span>[[<span class="pl-s"><span class="pl-pds">"</span>pull<span class="pl-pds">"</span></span>]])</pre></div>

<p>We can form the design matrix which was used internally to <code>lm</code>:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">X</span> <span class="pl-k">&lt;-</span> model.matrix(<span class="pl-k">~</span> <span class="pl-smi">type</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider.sub</span>)
colnames(<span class="pl-smi">X</span>)
head(<span class="pl-smi">X</span>)
tail(<span class="pl-smi">X</span>)</pre></div>

<p>Now we'll make a plot of the <code>X</code> matrix, by putting a black block for the 1's in the design matrix and a white block for the 0's. This plot will be more interesting for the linear models later on in this script. Along the y-axis is the sample number (the row number of the <code>data</code>), and along the x-axis is the column of the design matrix $\mathbf{X}$. If you have installed the <em>rafalib</em> library, you can make this plot with the <code>imagemat</code> function:</p>

<div class="highlight highlight-r"><pre><span class="pl-c"># library(devtools); install_github("ririzarr/rafalib")</span>
library(<span class="pl-smi">rafalib</span>)
imagemat(<span class="pl-smi">X</span>, <span class="pl-v">main</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Model matrix for linear model with one variable<span class="pl-pds">"</span></span>)</pre></div>

<h3>
<a id="user-content-examining-the-coefficients" class="anchor" href="#examining-the-coefficients" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examining the coefficients</h3>

<p>Now we will use a big chunk of code just to show how the coefficients from the linear model can be drawn as arrows. You wouldn't necessarily use this code in your daily practice, but it's helpful for visualizing what's going on in the linear model in your head.</p>

<div class="highlight highlight-r"><pre>stripchart(split(<span class="pl-smi">spider.sub</span><span class="pl-k">$</span><span class="pl-smi">friction</span>, <span class="pl-smi">spider.sub</span><span class="pl-k">$</span><span class="pl-smi">type</span>), 
           <span class="pl-v">vertical</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>, <span class="pl-v">pch</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>jitter<span class="pl-pds">"</span></span>, <span class="pl-v">las</span><span class="pl-k">=</span><span class="pl-c1">2</span>, <span class="pl-v">xlim</span><span class="pl-k">=</span>c(<span class="pl-c1">0</span>,<span class="pl-c1">3</span>), <span class="pl-v">ylim</span><span class="pl-k">=</span>c(<span class="pl-c1">0</span>,<span class="pl-c1">2</span>))
<span class="pl-smi">a</span> <span class="pl-k">&lt;-</span> <span class="pl-k">-</span><span class="pl-c1">0.25</span>
<span class="pl-smi">lgth</span> <span class="pl-k">&lt;-</span> .<span class="pl-c1">1</span>
library(<span class="pl-smi">RColorBrewer</span>)
<span class="pl-smi">cols</span> <span class="pl-k">&lt;-</span> brewer.pal(<span class="pl-c1">3</span>,<span class="pl-s"><span class="pl-pds">"</span>Dark2<span class="pl-pds">"</span></span>)
abline(<span class="pl-v">h</span><span class="pl-k">=</span><span class="pl-c1">0</span>)
arrows(<span class="pl-c1">1</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-c1">0</span>,<span class="pl-c1">1</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">1</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
abline(<span class="pl-v">h</span><span class="pl-k">=</span><span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">1</span>])
arrows(<span class="pl-c1">2</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">2</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
abline(<span class="pl-v">h</span><span class="pl-k">=</span><span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>])
legend(<span class="pl-s"><span class="pl-pds">"</span>right<span class="pl-pds">"</span></span>,names(<span class="pl-smi">coefs</span>),<span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">cols</span>,<span class="pl-v">cex</span><span class="pl-k">=</span>.<span class="pl-c1">75</span>,<span class="pl-v">bg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>white<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="user-content-a-linear-model-with-two-variables" class="anchor" href="#a-linear-model-with-two-variables" aria-hidden="true"><span class="octicon octicon-link"></span></a>A linear model with two variables</h2>

<p>Now, we'll continue and examine the full dataset, including the observations from all leg pairs. In order to model both the leg pair differences and the push vs pull difference, we need to include both terms in the formula. Let's see what kind of design matrix will be formed with two variables in the formula:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">X</span> <span class="pl-k">&lt;-</span> model.matrix(<span class="pl-k">~</span> <span class="pl-smi">type</span> <span class="pl-k">+</span> <span class="pl-smi">leg</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider</span>)
colnames(<span class="pl-smi">X</span>)
head(<span class="pl-smi">X</span>)
imagemat(<span class="pl-smi">X</span>, <span class="pl-v">main</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Model matrix for linear model with two factors<span class="pl-pds">"</span></span>)</pre></div>

<p>The first column is the intercept, and so has 1's for all samples. The second column has 1's for the push samples, and we can see that there are four groups of them. Finally, the third, fourth and fifth columns have 1's for the L2, L3 and L4 samples. The L1 samples do not have a column, because <em>L1</em> is the reference level for <code>leg</code>, as is <em>pull</em> for the <code>type</code> variable.</p>

<p>To run this model, we use <code>lm</code> with the formula <code>~ type + leg</code>. We'll save the linear model to <code>fitTL</code> standing for a fit with Type and Leg.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">fitTL</span> <span class="pl-k">&lt;-</span> lm(<span class="pl-smi">friction</span> <span class="pl-k">~</span> <span class="pl-smi">type</span> <span class="pl-k">+</span> <span class="pl-smi">leg</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider</span>)
summary(<span class="pl-smi">fitTL</span>)
(<span class="pl-smi">coefs</span> <span class="pl-k">&lt;-</span> coef(<span class="pl-smi">fitTL</span>))</pre></div>

<h3>
<a id="user-content-reminder-the-matrix-algebra" class="anchor" href="#reminder-the-matrix-algebra" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reminder: the matrix algebra</h3>

<p>We can do some quick matrix algebra to remind ourselves that the coefficients returned by <code>lm</code> are obtained with the following formula:</p>

<p>$$ \hat{\boldsymbol{\beta}} = (\mathbf{X}^t \mathbf{X})^{-1} \mathbf{X}^t \mathbf{Y} $$</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">Y</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span>
<span class="pl-smi">X</span> <span class="pl-k">&lt;-</span> model.matrix(<span class="pl-k">~</span> <span class="pl-smi">type</span> <span class="pl-k">+</span> <span class="pl-smi">leg</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider</span>)
<span class="pl-smi">beta</span> <span class="pl-k">&lt;-</span> solve(t(<span class="pl-smi">X</span>) <span class="pl-k">%*%</span> <span class="pl-smi">X</span>) <span class="pl-k">%*%</span> t(<span class="pl-smi">X</span>) <span class="pl-k">%*%</span> <span class="pl-smi">Y</span>
t(<span class="pl-smi">beta</span>)
<span class="pl-smi">coefs</span></pre></div>

<h3>
<a id="user-content-examining-the-coefficients-1" class="anchor" href="#examining-the-coefficients-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examining the coefficients</h3>

<p>We can make the same plot as before, with arrows for each of the coefficients in the model. Note that the orange arrow represents the difference between the push and pull samples for all groups.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">group</span> <span class="pl-k">&lt;-</span> <span class="pl-k">factor</span>(paste0(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">leg</span>, <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">type</span>))
stripchart(split(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span>, <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">group</span>), 
           <span class="pl-v">vertical</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>, <span class="pl-v">pch</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>jitter<span class="pl-pds">"</span></span>, <span class="pl-v">las</span><span class="pl-k">=</span><span class="pl-c1">2</span>, <span class="pl-v">xlim</span><span class="pl-k">=</span>c(<span class="pl-c1">0</span>,<span class="pl-c1">11</span>), <span class="pl-v">ylim</span><span class="pl-k">=</span>c(<span class="pl-c1">0</span>,<span class="pl-c1">2</span>))
<span class="pl-smi">cols</span> <span class="pl-k">&lt;-</span> brewer.pal(<span class="pl-c1">5</span>,<span class="pl-s"><span class="pl-pds">"</span>Dark2<span class="pl-pds">"</span></span>)
abline(<span class="pl-v">h</span><span class="pl-k">=</span><span class="pl-c1">0</span>)
arrows(<span class="pl-c1">1</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-c1">0</span>,<span class="pl-c1">1</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">1</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
abline(<span class="pl-v">h</span><span class="pl-k">=</span><span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">1</span>])
arrows(<span class="pl-c1">3</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">3</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">3</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">5</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">5</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">4</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">7</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">7</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">5</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">2</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">2</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
segments(<span class="pl-c1">3</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-c1">4</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">3</span>])
arrows(<span class="pl-c1">4</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-c1">4</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
segments(<span class="pl-c1">5</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>],<span class="pl-c1">6</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">4</span>])
arrows(<span class="pl-c1">6</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>],<span class="pl-c1">6</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
segments(<span class="pl-c1">7</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>],<span class="pl-c1">8</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">5</span>])
arrows(<span class="pl-c1">8</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>],<span class="pl-c1">8</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
legend(<span class="pl-s"><span class="pl-pds">"</span>right<span class="pl-pds">"</span></span>,names(<span class="pl-smi">coefs</span>),<span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">cols</span>,<span class="pl-v">cex</span><span class="pl-k">=</span>.<span class="pl-c1">75</span>,<span class="pl-v">bg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>white<span class="pl-pds">"</span></span>)</pre></div>

<p>Because we have 8 groups, and only 5 coefficients, the fitted means (the tips of the arrows) do not line up exactly with the mean of each group, like they did for the previous example of a two group linear model.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">s</span> <span class="pl-k">&lt;-</span> split(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span>, <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">group</span>)
mean(<span class="pl-smi">s</span>[[<span class="pl-s"><span class="pl-pds">"</span>L1pull<span class="pl-pds">"</span></span>]])
<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]
mean(<span class="pl-smi">s</span>[[<span class="pl-s"><span class="pl-pds">"</span>L1push<span class="pl-pds">"</span></span>]])
<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>] <span class="pl-k">+</span> <span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>]</pre></div>

<p>We can demonstrate, though, that the push vs pull coefficient, <code>coefs[2]</code>, is now a weighted mean of the difference of means for each group. And the weighting is determined by the sample size of each group. Note that the math works out so simply here because the sample size is equal for the push and pull subgroups within each leg pair. If the sample sizes were not equal for push and pull within each leg pair, the weighting is uniquely determined by a formula involving the sample size of each subgroup, the total sample size, and the number of coefficients. This can be worked out from $(\mathbf{X}^T \mathbf{X})^{-1} \mathbf{X}^T$.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">means</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">s</span>, <span class="pl-smi">mean</span>)
<span class="pl-c"># the sample size of push or pull groups for each leg pair</span>
<span class="pl-smi">ns</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">s</span>, <span class="pl-smi">length</span>)[c(<span class="pl-c1">1</span>,<span class="pl-c1">3</span>,<span class="pl-c1">5</span>,<span class="pl-c1">7</span>)]
(<span class="pl-smi">w</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">ns</span><span class="pl-k">/</span>sum(<span class="pl-smi">ns</span>))
sum(<span class="pl-smi">w</span> <span class="pl-k">*</span> (<span class="pl-smi">means</span>[c(<span class="pl-c1">2</span>,<span class="pl-c1">4</span>,<span class="pl-c1">6</span>,<span class="pl-c1">8</span>)] <span class="pl-k">-</span> <span class="pl-smi">means</span>[c(<span class="pl-c1">1</span>,<span class="pl-c1">3</span>,<span class="pl-c1">5</span>,<span class="pl-c1">7</span>)]))
<span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>]</pre></div>

<h3>
<a id="user-content-contrasting-the-coefficients" class="anchor" href="#contrasting-the-coefficients" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contrasting the coefficients</h3>

<p>To introduce the concept of <em>contrasts</em>, first consider the comparisons which we can read off from the linear model summary:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">coefs</span></pre></div>

<p>We have the push vs pull effect across all leg pairs, and and the L2 vs L1 effect, the L3 vs L1 effect, and the L4 vs L1 effect. What if we want to compare two groups, and one of the groups is not L1? The solution to this question is to use <em>contrasts</em>. </p>

<p>A <em>contrast</em> is a combination of coefficients: $\mathbf{C} \hat{\boldsymbol{\beta}}$, where $\mathbf{C}$ is a row vector with as many columns as the number of coefficients in the linear model. If $\mathbf{C}$ has a 0 then the coefficients are not involved in the contrast.</p>

<p>If we want to compare L3 and L2, this is equivalent to contrasting two coefficents from the linear model, because in this contrast, the comparison to the reference level <em>L1</em> cancels out:</p>

<p>$$ (L3 - L1) - (L2 - L1) = L3 - L2 $$</p>

<p>An easy way to make these contrasts of two groups is to use the <code>contrast</code> function from the <em>contrast</em> package. We just need to specify which groups we want to compare. We have to pick one of <em>pull</em> or <em>push</em> types, although the answer will not differ, which will we see below.</p>

<div class="highlight highlight-r"><pre><span class="pl-c"># install.packages("contrast")</span>
library(<span class="pl-smi">contrast</span>)
<span class="pl-smi">L3vsL2</span> <span class="pl-k">&lt;-</span> contrast(<span class="pl-smi">fitTL</span>,<span class="pl-k">list</span>(<span class="pl-v">leg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>L3<span class="pl-pds">"</span></span>,<span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>pull<span class="pl-pds">"</span></span>),<span class="pl-k">list</span>(<span class="pl-v">leg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>L2<span class="pl-pds">"</span></span>,<span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>pull<span class="pl-pds">"</span></span>))
<span class="pl-smi">L3vsL2</span></pre></div>

<p>We can show that the effect size estimate is just the difference between two coefficients. The contrast vector used by <code>contrast</code> is stored as <code>X</code> within the resulting object:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>] <span class="pl-k">-</span> <span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>]
(<span class="pl-smi">C</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">L3vsL2</span><span class="pl-k">$</span><span class="pl-smi">X</span>)
<span class="pl-smi">C</span> <span class="pl-k">%*%</span> <span class="pl-smi">beta</span></pre></div>

<p>What about the standard error, and t-statistic? As before, the t-statistic is the estimate (<code>Contrast</code>) divided by the standard error (<code>S.E.</code>). The standard error of the contrast estimate is formed by multiplying the contrast vector $\mathbf{C}$ on either side of the estimated covariance matrix, $\Sigma \equiv \mathrm{Var}(\hat{\boldsymbol{\beta}})$:</p>

<p>$$ \sqrt{\mathbf{C} \mathbf{\Sigma} \mathbf{C}^T} $$</p>

<p>where we saw the covariance of the coefficients earlier:</p>

<p>$$ \mathbf{\Sigma} = \hat{\sigma}^2 (\mathbf{X}^T \mathbf{X})^{-1}$$</p>

<div class="highlight highlight-r"><pre>(<span class="pl-smi">Sigma</span> <span class="pl-k">&lt;-</span> sum(<span class="pl-smi">fitTL</span><span class="pl-k">$</span><span class="pl-smi">residuals</span><span class="pl-k">^</span><span class="pl-c1">2</span>)<span class="pl-k">/</span>(nrow(<span class="pl-smi">X</span>) <span class="pl-k">-</span> ncol(<span class="pl-smi">X</span>)) <span class="pl-k">*</span> solve(t(<span class="pl-smi">X</span>) <span class="pl-k">%*%</span> <span class="pl-smi">X</span>))
sqrt(<span class="pl-smi">C</span> <span class="pl-k">%*%</span> <span class="pl-smi">Sigma</span> <span class="pl-k">%*%</span> t(<span class="pl-smi">C</span>))
<span class="pl-smi">L3vsL2</span><span class="pl-k">$</span><span class="pl-smi">SE</span></pre></div>

<p>Again, to show it doesn't matter if we had picked <code>type="push"</code>. The reason it does not change the contrast is because it leads to addition of the <code>typepush</code> effect on both sides of the difference, which cancels out.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">L3vsL2.equiv</span> <span class="pl-k">&lt;-</span> contrast(<span class="pl-smi">fitTL</span>,<span class="pl-k">list</span>(<span class="pl-v">leg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>L3<span class="pl-pds">"</span></span>,<span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>push<span class="pl-pds">"</span></span>),<span class="pl-k">list</span>(<span class="pl-v">leg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>L2<span class="pl-pds">"</span></span>,<span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>push<span class="pl-pds">"</span></span>))
<span class="pl-smi">L3vsL2.equiv</span><span class="pl-k">$</span><span class="pl-smi">X</span></pre></div>

<h2>
<a id="user-content-a-linear-model-with-interactions" class="anchor" href="#a-linear-model-with-interactions" aria-hidden="true"><span class="octicon octicon-link"></span></a>A linear model with interactions</h2>

<p>As we saw in the previous linear model, we assumed that the push vs pull effect was the same for all of the leg pairs (the same orange arrow). You can easily see that this does not capture the data that well, that is, the tips of the arrows did not line up perfectly with the group averages. For the L1 leg pair, the push vs pull coefficient overshot, and for the L3 leg pair, the push vs pull coefficient was too small.</p>

<p><em>Interaction</em> terms will help us overcome this problem, by introducing additional terms to compensate for differences in the push vs pull effect across the 4 groups. As we already have a push vs pull term in the model, we only need to add three more terms to have the freedom to find leg-pair-specific push vs pull differences. Interaction terms are added to the design matrix simply by multiplying the columns of the design matrix representing existing terms. </p>

<p>We can see this by building our model with an <em>interaction</em> between <code>type</code> and <code>leg</code>, by including an extra term in the formula <code>type:leg</code>. An equivalent way to specify this model is <code>~ type*leg</code> which will expand to the formula shown below, with main effects for <code>type</code>, <code>leg</code> and an interaction of <code>type:leg</code>.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">X</span> <span class="pl-k">&lt;-</span> model.matrix(<span class="pl-k">~</span> <span class="pl-smi">type</span> <span class="pl-k">+</span> <span class="pl-smi">leg</span> <span class="pl-k">+</span> <span class="pl-smi">type</span><span class="pl-k">:</span><span class="pl-smi">leg</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider</span>)
colnames(<span class="pl-smi">X</span>)
head(<span class="pl-smi">X</span>)
imagemat(<span class="pl-smi">X</span>, <span class="pl-v">main</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Model matrix for linear model with interactions<span class="pl-pds">"</span></span>)</pre></div>

<p>Note that columns 6-8 (<code>typepush:legL2</code>, <code>typepush:legL3</code>, and <code>typepush:legL4</code>) are the product of the 2nd column (<code>typepush</code>) and the 3-5 columns (the three <code>leg</code> columns). Looking at the last column for example, the <code>typepush:legL4</code> column will give an extra term $\beta_{\textrm{push,L4}}$ to those samples which are both push samples and leg pair L4 samples. This will account for when the mean samples in the L4-push group is not simply the addition of the main push coefficient and the main L4 coefficient.</p>

<p>We can run the linear model using the same code as before:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">fitX</span> <span class="pl-k">&lt;-</span> lm(<span class="pl-smi">friction</span> <span class="pl-k">~</span> <span class="pl-smi">type</span> <span class="pl-k">+</span> <span class="pl-smi">leg</span> <span class="pl-k">+</span> <span class="pl-smi">type</span><span class="pl-k">:</span><span class="pl-smi">leg</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider</span>)
summary(<span class="pl-smi">fitX</span>)
<span class="pl-smi">coefs</span> <span class="pl-k">&lt;-</span> coef(<span class="pl-smi">fitX</span>)</pre></div>

<h3>
<a id="user-content-examining-the-coefficients-2" class="anchor" href="#examining-the-coefficients-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examining the coefficients</h3>

<p>Here is where the plot with arrows help us to see what is going on with the interaction terms. The interaction terms (the yellow, brown and silver arrows), are extra terms which help us to fit leg-pair-specific differences in the push vs pull difference. The orange arrow now represents the push vs pull difference for the reference leg pair, which is L1. If the interaction term is large, this means that the push vs pull difference for that group is different than the push vs pull difference in the reference leg pair.</p>

<p>Now, as we have eight terms in the model and 8 parameters, you can check that the tips of the arrowheads are exactly equal to the group means.</p>

<div class="highlight highlight-r"><pre>stripchart(split(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span>, <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">group</span>), 
           <span class="pl-v">vertical</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>, <span class="pl-v">pch</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>jitter<span class="pl-pds">"</span></span>, <span class="pl-v">las</span><span class="pl-k">=</span><span class="pl-c1">2</span>, <span class="pl-v">xlim</span><span class="pl-k">=</span>c(<span class="pl-c1">0</span>,<span class="pl-c1">11</span>), <span class="pl-v">ylim</span><span class="pl-k">=</span>c(<span class="pl-c1">0</span>,<span class="pl-c1">2</span>))
<span class="pl-smi">cols</span> <span class="pl-k">&lt;-</span> brewer.pal(<span class="pl-c1">8</span>,<span class="pl-s"><span class="pl-pds">"</span>Dark2<span class="pl-pds">"</span></span>)
abline(<span class="pl-v">h</span><span class="pl-k">=</span><span class="pl-c1">0</span>)
arrows(<span class="pl-c1">1</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-c1">0</span>,<span class="pl-c1">1</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">1</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
abline(<span class="pl-v">h</span><span class="pl-k">=</span><span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">1</span>])
arrows(<span class="pl-c1">2</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">2</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">3</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">3</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">3</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">5</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">5</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">4</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">7</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>],<span class="pl-c1">7</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">5</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
<span class="pl-c"># now the interactions:</span>
segments(<span class="pl-c1">3</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-c1">4</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">3</span>])
arrows(<span class="pl-c1">4</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-c1">4</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">4</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>],<span class="pl-c1">4</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">6</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">6</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
<span class="pl-c">#</span>
segments(<span class="pl-c1">5</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>],<span class="pl-c1">6</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">4</span>])
arrows(<span class="pl-c1">6</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>],<span class="pl-c1">6</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">6</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-c1">6</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">7</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">7</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
<span class="pl-c">#</span>
segments(<span class="pl-c1">7</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>],<span class="pl-c1">8</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">5</span>])
arrows(<span class="pl-c1">8</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>],<span class="pl-c1">8</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">2</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
arrows(<span class="pl-c1">8</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>],<span class="pl-c1">8</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-c1">1</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>]<span class="pl-k">+</span><span class="pl-smi">coefs</span>[<span class="pl-c1">8</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-c1">8</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
legend(<span class="pl-s"><span class="pl-pds">"</span>right<span class="pl-pds">"</span></span>,names(<span class="pl-smi">coefs</span>),<span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">cols</span>,<span class="pl-v">cex</span><span class="pl-k">=</span>.<span class="pl-c1">75</span>,<span class="pl-v">bg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>white<span class="pl-pds">"</span></span>)</pre></div>

<h3>
<a id="user-content-contrasts" class="anchor" href="#contrasts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contrasts</h3>

<p>Again we will show how to combine coefficients from the model using <em>contrasts</em>. For some simple cases, we can use the contrast package. Suppose we want to know the push vs pull effect for the L2 leg pair samples. We can see from the arrow plot that this is the orange arrow plus the yellow arrow. We can also specify this comparison with the <code>contrast</code> function:</p>

<div class="highlight highlight-r"><pre>library(<span class="pl-smi">contrast</span>)
<span class="pl-smi">L2push.vs.pull</span> <span class="pl-k">&lt;-</span> contrast(<span class="pl-smi">fitX</span>,
                   <span class="pl-k">list</span>(<span class="pl-v">leg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>L2<span class="pl-pds">"</span></span>, <span class="pl-v">type</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>push<span class="pl-pds">"</span></span>), 
                   <span class="pl-k">list</span>(<span class="pl-v">leg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>L2<span class="pl-pds">"</span></span>, <span class="pl-v">type</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>pull<span class="pl-pds">"</span></span>))
<span class="pl-smi">L2push.vs.pull</span>
<span class="pl-smi">coefs</span>[<span class="pl-c1">2</span>] <span class="pl-k">+</span> <span class="pl-smi">coefs</span>[<span class="pl-c1">6</span>]</pre></div>

<h3>
<a id="user-content-differences-of-differences" class="anchor" href="#differences-of-differences" aria-hidden="true"><span class="octicon octicon-link"></span></a>Differences of differences</h3>

<p>As we mentioned above, if we want to ask the question, is the push vs pull difference <em>different</em> in L2 compared to L1, this is answered by a single term in the model, the <code>typepush:legL2</code> term corresponding to the yellow arrow in the plot. Similarly, we can test the L3 vs L1 and L4 vs L1 differences, straight from the summary table of the linear model:</p>

<div class="highlight highlight-r"><pre>summary(<span class="pl-smi">fitX</span>)</pre></div>

<h3>
<a id="user-content-difference-of-differences-not-involving-the-reference-level" class="anchor" href="#difference-of-differences-not-involving-the-reference-level" aria-hidden="true"><span class="octicon octicon-link"></span></a>Difference of differences not involving the reference level</h3>

<p>Suppose we want to know if the push vs pull difference is <em>different</em> for the L3 leg pair vs the L2 leg pair. Considering the arrows in the plot, the push vs pull difference for a leg pair other then L1 is the <code>typepush</code> arrow plus the interaction term for that group.</p>

<p>If we work out the math for comparing across two non-reference leg pairs, this is:</p>

<p>$$ (typepush + typepush:legL3) - (typepush + typepush:legL2) $$ </p>

<p>$$ = typepush:legL3 - typepush:legL2 $$</p>

<p>We can't make this contrast using the <code>contrast</code> function shown before, but we can make this comparison using the <code>glht</code> (for "general linear hypothesis test") function from the <em>multcomp</em> package. All we need to do is form a 1-row matrix which has a -1 for the <code>typepush:legL2</code> effect and a +1 for the <code>typepush:legL3</code> effect. We provide this matrix to the <code>linfct</code> (linear function) argument, and obtain a summary table for this contrast alone.</p>

<p><em>Note</em>: there are other ways to perform contrasts using base R, but this function is in my opinion simpler to use.</p>

<div class="highlight highlight-r"><pre><span class="pl-c"># install.packages("multcomp")</span>
library(<span class="pl-smi">multcomp</span>)
<span class="pl-smi">C</span> <span class="pl-k">&lt;-</span> <span class="pl-k">matrix</span>(c(<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-k">-</span><span class="pl-c1">1</span>,<span class="pl-c1">1</span>,<span class="pl-c1">0</span>), <span class="pl-c1">1</span>)
<span class="pl-smi">L3vsL2interaction</span> <span class="pl-k">&lt;-</span> glht(<span class="pl-smi">fitX</span>, <span class="pl-v">linfct</span><span class="pl-k">=</span><span class="pl-smi">C</span>)
summary(<span class="pl-smi">L3vsL2interaction</span>)
<span class="pl-smi">coefs</span>[<span class="pl-c1">7</span>] <span class="pl-k">-</span> <span class="pl-smi">coefs</span>[<span class="pl-c1">6</span>]</pre></div>

<h3>
<a id="user-content-testing-all-differences-of-differences-analysis-of-variance" class="anchor" href="#testing-all-differences-of-differences-analysis-of-variance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing all differences of differences: analysis of variance</h3>

<p>Finally, suppose that we want to know if the push vs pull difference is <em>different</em> across leg pairs in general. Here we are not comparing any two leg pairs in particular but want to know if the three interaction terms which represent differences in the push vs pull difference are larger than we would expect them to be, if the push vs pull difference was actually contant across the leg pairs.</p>

<p>In statistics, such a question can be answered by an "analysis of variance", which is often abbreviated <em>ANOVA</em>. The <code>anova</code> adds terms to the model in the sequence provided in the formula, and with each additional term or set of terms, the function calculates the reduction in the sum of squares of the residuals. Let's first print this table and then examine the results in detail:</p>

<div class="highlight highlight-r"><pre>anova(<span class="pl-smi">fitX</span>)</pre></div>

<p>If we consider the first line, it says that, from a model with only an intercept, adding the information about which observations were push and which were pull reduced the sum of squares by 42.783. We can reproduce this number in R by examining the sum of squares from a model with only an intercept (the mean of all observations) and the sum of squares from a model which groups by type:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">mu0</span> <span class="pl-k">&lt;-</span> mean(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span>)
<span class="pl-smi">initial.ss</span> <span class="pl-k">&lt;-</span> sum((<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span> <span class="pl-k">-</span> <span class="pl-smi">mu0</span>)<span class="pl-k">^</span><span class="pl-c1">2</span>)
<span class="pl-smi">s</span> <span class="pl-k">&lt;-</span> split(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span>, <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">type</span>)
<span class="pl-smi">after.type.ss</span> <span class="pl-k">&lt;-</span> sum(sapply(<span class="pl-smi">s</span>, <span class="pl-k">function</span>(<span class="pl-smi">x</span>) sum((<span class="pl-smi">x</span> <span class="pl-k">-</span> mean(<span class="pl-smi">x</span>))<span class="pl-k">^</span><span class="pl-c1">2</span>)))
(<span class="pl-smi">type.ss</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">initial.ss</span> <span class="pl-k">-</span> <span class="pl-smi">after.type.ss</span>)</pre></div>

<p>Through <a href="http://en.wikipedia.org/wiki/Partition_of_sums_of_squares#Proof">simple arithmetic</a>, this can be shown to be equivalent to the sum of squares of the fitted values from the model using the type information to the fitted values from the model with only an intercept:</p>

<div class="highlight highlight-r"><pre>sum(sapply(<span class="pl-smi">s</span>, <span class="pl-smi">length</span>) <span class="pl-k">*</span> (sapply(<span class="pl-smi">s</span>, <span class="pl-smi">mean</span>) <span class="pl-k">-</span> <span class="pl-smi">mu0</span>)<span class="pl-k">^</span><span class="pl-c1">2</span>)</pre></div>

<p>Note that the order of terms in the formula, and therefore rows in the ANOVA table is important: each row considers the reduction in the sum of squares after adding information to the model in the previous row.</p>

<p>The other columns in the ANOVA table show the "degrees of freedom" with each row. As the <code>type</code> variable introduced only one term in the model, the <code>Df</code> column has a 1. Because the <code>leg</code> variable introduced three terms in the model (<code>legL2</code>, <code>legL3</code> and <code>legL4</code>), the <code>Df</code> column has a 3.</p>

<p>Finally, there is a column which lists the <em>F value</em>. The F value is the <em>mean of squares</em> for the inclusion of the terms of interest (the sum of squares divided by the degrees of freedom) divided by the mean squared residuals (from the bottom row):</p>

<p>$$ r_i = Y_i - \hat{Y}_i $$</p>

<p>$$ Mean Sq Residuals = \frac{1}{N - p} \sum_{i=1}^N r_i^2 $$</p>

<p>where $p$ is the sum of all the terms in the model (here 8, including the intercept term).</p>

<p>Under the null hypothesis that the true value of the additional terms is 0, we have a theoretical result for what the distribution of the F value will be for each row. Let's take as an example the last row, the three interaction terms. Under the null hypothesis that the true value for these three additional terms is actually 0, e.g. $\beta_{\textrm{push,L2}} = 0, \beta_{\textrm{push,L3}} = 0, \beta_{\textrm{push,L4}} = 0$, then we can calculate the chance of seeing such a large F value for this row of the ANOVA table. Note that we are only concerned with large values here, because we have a ratio of sum of squares, the F value can only be positive. </p>

<p>The p-value in the last column for the <code>type:leg</code> row can be interpreted as following: under the null hypothesis that there are no differences in the push vs pull difference across leg pair, this is the probability of the interaction terms explaining so much of the observed variance. If this p-value is small, we would consider rejecting the null hypothesis that the push vs pull difference is the same across leg pair.</p>

<p>The <a href="http://en.wikipedia.org/wiki/F-distribution">F distribution</a> has two parameters: one for the degrees of freedom of the numerator (the terms of interest) and one for the denominator (the residuals). In the case of the interactions row, this is 3, the number of interaction terms divided by 274, the number of samples minus the total number of coefficients.</p>

<h2>
<a id="user-content-a-different-specification-of-the-same-model" class="anchor" href="#a-different-specification-of-the-same-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>A different specification of the same model</h2>

<p>In this last section, we show an alternate way to specify the model where we suppose that each group has its own mean (that the push vs pull effect is not the same for each leg pair). This specification is in some ways simpler, but it does not allow us to build the ANOVA table as above, because it does not split interaction terms out in the same way. Here we simply include a term for each unique combination of <code>type</code> and <code>leg</code>. We include a <code>0 +</code> in the formula because we do not want to include an intercept:</p>

<div class="highlight highlight-r"><pre><span class="pl-c"># earlier, we defined the 'group' column:</span>
<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">group</span> <span class="pl-k">&lt;-</span> <span class="pl-k">factor</span>(paste0(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">leg</span>, <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">type</span>))
<span class="pl-smi">X</span> <span class="pl-k">&lt;-</span> model.matrix(<span class="pl-k">~</span> <span class="pl-c1">0</span> <span class="pl-k">+</span> <span class="pl-smi">group</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider</span>)
colnames(<span class="pl-smi">X</span>)
head(<span class="pl-smi">X</span>)
imagemat(<span class="pl-smi">X</span>, <span class="pl-v">main</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Model matrix for linear model with group variable<span class="pl-pds">"</span></span>)</pre></div>

<p>We can run the linear model with the familiar call:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">fitG</span> <span class="pl-k">&lt;-</span> lm(<span class="pl-smi">friction</span> <span class="pl-k">~</span> <span class="pl-c1">0</span> <span class="pl-k">+</span> <span class="pl-smi">group</span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">spider</span>)
summary(<span class="pl-smi">fitG</span>)
<span class="pl-smi">coefs</span> <span class="pl-k">&lt;-</span> coef(<span class="pl-smi">fitG</span>)</pre></div>

<h3>
<a id="user-content-examining-the-coefficients-3" class="anchor" href="#examining-the-coefficients-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examining the coefficients</h3>

<p>Now we have eight arrows, on for each group. The arrow tips align directly with the mean of each group:</p>

<div class="highlight highlight-r"><pre>stripchart(split(<span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">friction</span>, <span class="pl-smi">spider</span><span class="pl-k">$</span><span class="pl-smi">group</span>), 
           <span class="pl-v">vertical</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>, <span class="pl-v">pch</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>jitter<span class="pl-pds">"</span></span>, <span class="pl-v">las</span><span class="pl-k">=</span><span class="pl-c1">2</span>, <span class="pl-v">xlim</span><span class="pl-k">=</span>c(<span class="pl-c1">0</span>,<span class="pl-c1">11</span>), <span class="pl-v">ylim</span><span class="pl-k">=</span>c(<span class="pl-c1">0</span>,<span class="pl-c1">2</span>))
<span class="pl-smi">cols</span> <span class="pl-k">&lt;-</span> brewer.pal(<span class="pl-c1">8</span>,<span class="pl-s"><span class="pl-pds">"</span>Dark2<span class="pl-pds">"</span></span>)
abline(<span class="pl-v">h</span><span class="pl-k">=</span><span class="pl-c1">0</span>)
<span class="pl-k">for</span> (<span class="pl-smi">i</span> <span class="pl-k">in</span> <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>) {
  arrows(<span class="pl-smi">i</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-c1">0</span>,<span class="pl-smi">i</span><span class="pl-k">+</span><span class="pl-smi">a</span>,<span class="pl-smi">coefs</span>[<span class="pl-smi">i</span>],<span class="pl-v">lwd</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">col</span><span class="pl-k">=</span><span class="pl-smi">cols</span>[<span class="pl-smi">i</span>],<span class="pl-v">length</span><span class="pl-k">=</span><span class="pl-smi">lgth</span>)
}
legend(<span class="pl-s"><span class="pl-pds">"</span>right<span class="pl-pds">"</span></span>,names(<span class="pl-smi">coefs</span>),<span class="pl-v">fill</span><span class="pl-k">=</span><span class="pl-smi">cols</span>,<span class="pl-v">cex</span><span class="pl-k">=</span>.<span class="pl-c1">75</span>,<span class="pl-v">bg</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>white<span class="pl-pds">"</span></span>)</pre></div>

<h3>
<a id="user-content-simple-contrasts-using-the-contrast-package" class="anchor" href="#simple-contrasts-using-the-contrast-package" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple contrasts using the contrast package</h3>

<p>While we cannot perform an F test with this formulation, we can easily contrast individual groups using the <code>contrast</code> function:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">groupL2push.vs.pull</span> <span class="pl-k">&lt;-</span> contrast(<span class="pl-smi">fitG</span>,
                                <span class="pl-k">list</span>(<span class="pl-v">group</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>L2push<span class="pl-pds">"</span></span>), 
                                <span class="pl-k">list</span>(<span class="pl-v">group</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>L2pull<span class="pl-pds">"</span></span>))
<span class="pl-smi">groupL2push.vs.pull</span>
<span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>] <span class="pl-k">-</span> <span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>]</pre></div>

<h3>
<a id="user-content-differences-of-differences-when-there-is-not-an-intercept" class="anchor" href="#differences-of-differences-when-there-is-not-an-intercept" aria-hidden="true"><span class="octicon octicon-link"></span></a>Differences of differences when there is not an intercept</h3>

<p>And we can also make pair-wise comparisons of the push vs pull difference. For example if we want to compare the push vs pull difference in leg pair L3 vs leg pair L2:</p>

<p>$$ (L3push - L3 pull) - (L2push - L2pull) $$</p>

<p>$$ = L3 push + L2 pull - L3pull - L2push $$</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">C</span> <span class="pl-k">&lt;-</span> <span class="pl-k">matrix</span>(c(<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">1</span>,<span class="pl-k">-</span><span class="pl-c1">1</span>,<span class="pl-k">-</span><span class="pl-c1">1</span>,<span class="pl-c1">1</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>), <span class="pl-c1">1</span>)
<span class="pl-smi">groupL3vsL2interaction</span> <span class="pl-k">&lt;-</span> glht(<span class="pl-smi">fitG</span>, <span class="pl-v">linfct</span><span class="pl-k">=</span><span class="pl-smi">C</span>)
summary(<span class="pl-smi">groupL3vsL2interaction</span>)
names(<span class="pl-smi">coefs</span>)
(<span class="pl-smi">coefs</span>[<span class="pl-c1">6</span>] <span class="pl-k">-</span> <span class="pl-smi">coefs</span>[<span class="pl-c1">5</span>]) <span class="pl-k">-</span> (<span class="pl-smi">coefs</span>[<span class="pl-c1">4</span>] <span class="pl-k">-</span> <span class="pl-smi">coefs</span>[<span class="pl-c1">3</span>])</pre></div>
</article>
  </div>

</div>

<a href="#jump-to-line" rel="facebox[.linejump]" data-hotkey="l" style="display:none">Jump to Line</a>
<div id="jump-to-line" style="display:none">
  <form accept-charset="UTF-8" action="" class="js-jump-to-line-form" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
    <input class="linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" autofocus>
    <button type="submit" class="btn">Go</button>
</form></div>

        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer" role="contentinfo">
    <ul class="site-footer-links right">
        <li><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
      <li><a href="https://developer.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
      <li><a href="https://shop.github.com" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
        <li><a href="https://github.com/blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
        <li><a href="https://github.com/about" data-ga-click="Footer, go to about, text:about">About</a></li>

    </ul>

    <a href="https://github.com" aria-label="Homepage">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
</a>
    <ul class="site-footer-links">
      <li>&copy; 2015 <span title="0.05689s from github-fe116-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms" data-ga-click="Footer, go to terms, text:terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy" data-ga-click="Footer, go to privacy, text:privacy">Privacy</a></li>
        <li><a href="https://github.com/security" data-ga-click="Footer, go to security, text:security">Security</a></li>
        <li><a href="https://github.com/contact" data-ga-click="Footer, go to contact, text:contact">Contact</a></li>
    </ul>
  </div>
</div>


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-suggester-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="fullscreen-contents js-fullscreen-contents" placeholder=""></textarea>
      <div class="suggester-container">
        <div class="suggester fullscreen-suggester js-suggester js-navigation-container"></div>
      </div>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w"
      aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    
    

    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-x flash-close js-ajax-error-dismiss" aria-label="Dismiss error"></a>
      Something went wrong with that request. Please try again.
    </div>


      <script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/frameworks-2c8ae50712a47d2b83d740cb875d55cdbbb3fdbccf303951cc6b7e63731e0c38.js"></script>
      <script async="async" crossorigin="anonymous" src="https://assets-cdn.github.com/assets/github-d719016cdd96ecc8c9af5369a38f86aa56d6ddf33e3a1a56279f23456d49c801.js"></script>
      
      

      <div class="js-socket-channel" data-channel="test:neerajvashistha"></div>

  </body>
</html>

